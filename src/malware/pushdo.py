
import hashlib
from mlib.crypto import rc4

def find_buffer(d):
    r= -1,None
    for i in range(len(d) - 0x300):
        data= d[i:i+0x300]
        key =  hashlib.md5(data[:16]).digest()
        xdata = rc4.decrypt(data[16:],key)
        chk= hashlib.md5(data[:16] + xdata[:-16]).digest()

        if chk == xdata[752-16:]:
            r = i, data[:16]+xdata
            break
    return r
